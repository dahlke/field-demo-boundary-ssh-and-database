slug: boundary-ssh-and-database
id: adnyt8negprv
type: track
title: Using Boundary for SSH and Database Access
teaser: TODO
description: TODO
icon: https://storage.googleapis.com/instruqt-frontend/assets/hashicorp/tracks/boundary.png
tags:
- terraform
owner: hashicorp
developers:
- neil@hashicorp.com
private: true
published: false
show_timer: true
challenges:
- slug: explore-the-admin-ui
  id: wyaxsa25ysd1
  type: challenge
  title: Explore the Admin UI
  teaser: Get familiar with Bonudary's admin UI before jumping into accessing targets.
  notes:
  - type: text
    contents: |-
      Boundary enables simple and secure access to dynamic infrastructure by:

      - Identity-based access controls: Streamline just-in-time access to privileged sessions (e.g. TCP, SSH, RDP) for users and applications. Tightly control access permissions with extensible role-based access controls.
      - Access Automation: Define your perimeter of resources, identities, and access controls as code through Boundary's fully-instrumented Terraform Provider, REST API, CLI, and SDK. Automate the discovery of new resources and enforcement of existing policies as resources are provisioned.
      - Session Visibility: Security administrators gain monitor and managed the privileged sessions established with Boundary. Export session logs to your analytics tool of choice.

      In this track, you will learn how to use Boundary to dynamically access hosts via SSH, as well as remote Postgres database access.
  - type: text
    contents: Traditional approaches like SSH bastion hosts or VPNs that require distributing
      and managing credentials, configure network controls like firewalls, and expose
      the private network. Boundary provides a secure way to access to hosts and critical
      systems without having to manage credentials or expose your network.
  - type: text
    contents: 'TODO: Explain Controllers vs Workers.'
  - type: text
    contents: 'TODO: Explain Roles, Principals, Grants, Projects, Host Catalogs, etc.'
  - type: text
    contents: 'TODO: Show a picture of all the moving pieces here.'
  assignment: |-
    # Explore the Admin Console

    _TODO: make this more useful that the content in Learn_

    Boundary's Admin Console  provides an easy way to manage resources. Before using Bonudary to securely access any dynamic infrastructure,
    you should take a tour of the console to understand all the components.

    In this track, Boundary has already been [installed](https://learn.hashicorp.com/tutorials/boundary/getting-started-install?in=boundary/getting-started)
    for you. A Boundary Controller and a Boundary Worker are also already running. To make your initial
    tour through Boundary a little more interesting, Boundary was [initialized with the initial login role
    creation](https://www.boundaryproject.io/docs/installing/no-gen-resources#initialize-the-database).

    _TODO: link the other track that shows how to set everything up, and note that it should be done before this track to learn all the components._

    Identity is a core concept in Boundary. Identity is represented by two types of resources, mapping to common security principals:

    - [Users](https://www.boundaryproject.io/docs/concepts/domain-model/users), which represent distinct entities that can be tied to authentication accounts
    - [Groups](https://www.boundaryproject.io/docs/concepts/domain-model/groups), which are collections of Users that allow for easier access management

    [Roles](https://www.boundaryproject.io/docs/concepts/domain-model/roles) map users and groups to a set of grants, which provide the ability to perform actions within the system.

    ---

    # Exploring Roles, Principals and Grants in the Admin UI

    Open the Boundary UI tab. You should see a login screen.

    _TODO: instructions on how to get the admin password to login_

    Once you have logged in, you will see the home screen containing all the top level resources in Boundary. Select *Roles* in the left sidebar, then select the "Administration" role.

    Notice that `admin` user is listed. *User*, *group*, and *project* are a type of principal which can be assigned to roles.

    Click on the *Grants* tab to view the permissions allowed on this role.  Grants represent strings of actions on resources: `id=<resource_id>; action=<actions>`

    The grant for Administration role indicates that all actions (`actions=*`) on all resources (`id=*;type=*`) are permitted. Refer to the documentation for more details.

    Return to the *Roles* list and select *Login and Default Grants* role.  Click *Grants* to view its permissions.

    A role can have multiple grants defined. Those grants are deleted when the role is deleted. A grant is also deleted if its associated resource is deleted.

    Select *Projects* and then *Generated project scope*. Notice that you can see *Sessions*, *Targets* and *Host Catalogs*.

    Select *Host Catalogs -> Generated host catalog -> Host Sets -> Generated host set* to view the details of the *Host Set*. You can then select the *Hosts* tab to view attached hosts.

    ---

    TODO: move this to it's own challenge

    *Exploring Projects, Host Catalogs, Host Sets, Hosts and Targets in the Admin UI*

    TODO: move this to it's own challenge
    *Connecting to Your First Target*

    ```
    boundary authenticate password \
      -auth-method-id=ampw_CU9oKwC4Q4 \
      -login-name=admin \
      -password=nqiUrFmjlmRI84HHq71E
    ```

    With [`pass`](https://www.passwordstore.org/):

    ```
    boundary authenticate password \
      -format=json \
      -auth-method-id=$GEN_AUTH_METHOD \
      -login-name=$GEN_LOGIN_NAME \
      -password=$GEN_PASSWORD | jq -r .
    ```

    With [`gnome-keyring`](https://wiki.gnome.org/Projects/GnomeKeyring):

    ```
    boundary authenticate password \
      -format=json \
      -auth-method-id=$GEN_AUTH_METHOD \
      -keyring-type="secret-service"\
      -login-name=$GEN_LOGIN_NAME \
      -password=$GEN_PASSWORD | jq -r .
    ```

    With no password manager:

    ```
    boundary authenticate password \
      -format=json \
      -auth-method-id=$GEN_AUTH_METHOD \
      -keyring-type="none"\
      -login-name=$GEN_LOGIN_NAME \
      -password=$GEN_PASSWORD | jq -r .
    ```

    Set the Boundary token using the token from above, or, use the simple one liner below.

    ```
    export BOUNDARY_TOKEN=<token_from_above>
    ```

    ```
    export BOUNDARY_TOKEN=$( \
      boundary authenticate password \
      -format=json \
      -auth-method-id=$GEN_AUTH_METHOD \
      -keyring-type="none"\
      -login-name=$GEN_LOGIN_NAME \
      -password=$GEN_PASSWORD | jq -r .item.attributes.token)
    ```

    Now that you understand the different components in boundary and how they are related to each other, it's time to
    navigate to our first target and connect to it.

    List the scopes in Boundary. You will use the automatically generated scope for this challenge.

    ```
    boundary scopes list
    ```

    You can put that ID into an env var easily using the following command.

    _TODO: stuff this into the bashrc in setup or solve._

    ```
    # NOTE: This is the global scope ID, we need the project scope ID
    export GEN_GLOBAL_SCOPE_ID=$(boundary scopes list -format=json | jq -r '.items[0].id')
    export GEN_PROJ_SCOPE_ID=$(boundary scopes list -scope-id=$GEN_GLOBAL_SCOPE_ID -format=json | jq -r '.items[0].id')
    echo $GEN_GLOBAL_SCOPE_ID
    echo $GEN_PROJ_SCOPE_ID
    ```

    Then, you want to list all the targets for your generated scope.

    ```
    boundary targets list
    ```

    ```
    boundary targets list -scope-id=$GEN_PROJ_SCOPE_ID
    ```

    ```
    export GEN_TARGET_ID=$(boundary targets list -scope-id=$GEN_PROJ_SCOPE_ID -format=json | jq -r '.items[0].id')
    echo $GEN_TARGET_ID
    ```

    _TODO: add a diagram of the components to the notes and tell the user they can go view that if they need a refresher._

    Get the details.

    ```
    boundary targets read -id=<target_id>
    ```

    ```
    boundary targets read -id=$GEN_TARGET_ID
    ```

    Connect.

    ```
    boundary connect ssh -target-id=$GEN_TARGET_ID
    // No workers error

    # ERROR IN WORKER JOURNAL
    # Jun 29 00:53:59 worker boundary[3986]: 2021-06-29T00:53:59.886Z [ERROR] worker: error making status request to controller: error="rpc error: code = Unavailable desc = last connection error: connection error: desc = "transport: Error while dialing unable to dial to controller: dial tcp: lookup boundary-controller on 127.0.0.53:53: server misbehaving"
    ```
  tabs:
  - title: VS Code
    type: service
    hostname: boundary-controller
    port: 8443
  - title: Controller
    type: terminal
    hostname: boundary-controller
  - title: Worker
    type: terminal
    hostname: boundary-worker
  - title: Boundary UI
    type: service
    hostname: boundary-controller
    port: 9200
  difficulty: advanced
  timelimit: 3600
- slug: configure-boundary
  id: yi1uavzhjjzw
  type: challenge
  title: Configure Boundary
  teaser: Build out the host catalog, host sets, hosts as well as some targets.
  notes:
  - type: text
    contents: TODO
  assignment: '*Configure Boundary*'
  tabs:
  - title: VS Code
    type: service
    hostname: boundary-controller
    port: 8443
  - title: Terminal
    type: terminal
    hostname: boundary-controller
  - title: Boundary UI
    type: service
    hostname: boundary-controller
    port: 9200
  difficulty: advanced
  timelimit: 3600
- slug: connect-to-host-with-ssh
  id: kzy7pthbem69
  type: challenge
  title: Connect to Host with SSH
  teaser: Connect to a remote host with an SSH session brokered by Boundary
  notes:
  - type: text
    contents: TODO
  assignment: '*Connect to Host with SSH*'
  tabs:
  - title: VS Code
    type: service
    hostname: boundary-controller
    port: 8443
  - title: Terminal
    type: terminal
    hostname: boundary-controller
  - title: Boundary UI
    type: service
    hostname: boundary-controller
    port: 9200
  difficulty: advanced
  timelimit: 3600
- slug: connect-to-database
  id: 29dntojnecqc
  type: challenge
  title: Connect to a Database
  teaser: Connect to a remote database with a session brokered by Boundary
  notes:
  - type: text
    contents: TODO
  assignment: '*Connect to a Database*'
  tabs:
  - title: VS Code
    type: service
    hostname: boundary-controller
    port: 8443
  - title: Terminal
    type: terminal
    hostname: boundary-controller
  - title: Boundary UI
    type: service
    hostname: boundary-controller
    port: 9200
  difficulty: advanced
  timelimit: 3600
checksum: "1079296278744496475"
